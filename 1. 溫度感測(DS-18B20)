  1 #! /usr/bin/python                                                                                                          
  2 #coding=utf-8
  3 
  4 import mysql.connector
  5 from mysql.connector import errorcode
  6 
  7 import time,datetime
  8 from time import strftime
  9 
 10 #obtain connection string information
 11 config={'host':'localhost',
 12         'user':'root',
 13         'passwd':'1234',
 14         'database':'IOT'}
 15 
 16 #construct connect string
 17 try:
 18     conn=mysql.connector.connect(**config)
 19     print"connection established"
 20 except mysql.connector.Error as err:
 21     if err.errno == errorcode.ER_ACCESS_DENIED_ERROR:
 22         print "sometihing is wrong with the user name or passwd."
 23     elif err.errno == errorcode.ER_BAD_DB_ERROR:
 24         print "Database does not exist."
 25     else:
 26         print err
 27 else:
 28     cursor = conn.cursor()
 29     now = strftime("%Y/%m/%d %H:%M:%S")
 30     file = open("/sys/bus/w1/devices/28-03172164d8ff/w1_slave")
 31     text = file.read()
 32     file.close
 33 
 34     secondline = text.split("\n")[1]
 35     tempdata = secondline.split(" ")[9]
 36     temp = float(tempdata[2:])
 37 
 38     temp = temp//100
 39     temp = temp/10
 40 
 41     cursor.execute("INSERT INTO temperature_DB(userid,temperature,`datetime`)VALUES(7,%s,%s)",(str(temp),now))
 42     print "Inserted "+str(cursor.rowcount)+" row(s) of data."
 43 
 44     conn.commit()
 45     #clearup
 46     cursor.close()
 47     conn.close()
 48     print "Done."
 49 
 50 
 51 #mycursor = temp.cursor()
 52 #mycursor.execute("CREATE DATABASE IOT CHARACTER SET utf8 COLLATE utf8_unicode_ci")
 53 #mycursor.execute("SHOW DATABASES")
 54 #for x in mycursor:
 55 #    print x
 56 
 57 #mycursor.execute("CREATE TABLE temperature_DB(ID serial PRIMARY KEY,userid INT, temperature float, datetime datetime)")
 58 
 59 
 60 #close
 61 #temp.close()
 
 
